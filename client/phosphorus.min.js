Phosphorus={};Phosphorus.baseUrl="http://146.185.144.4";Phosphorus.socket=io.connect(Phosphorus.baseUrl);Phosphorus.get=function(e,t){if(!Phosphorus.token){return t("token not set")}token_and_key=Phosphorus.token.toString()+":"+e.toString();if(Phosphorus.watched().contains(token_and_key)){return t(JSON.parse(localStorage[token_and_key]))}var n="/get";var r={token:Phosphorus.token,key:e};ajax(n,r,function(e){localStorage[token_and_key]=JSON.stringify(e);t(e)});Phosphorus.subscribe(e)};Phosphorus.set=function(e,t){if(!Phosphorus.token){return console.log("token not set")}var n="/set";var r={token:Phosphorus.token,key:e,value:t};ajax(n,r);Phosphorus.subscribe(e);return t};Phosphorus.fetch=function(e,t,n){if(!Phosphorus.token){return n("token not set")}Phosphorus.get(e,function(r){if(!r){Phosphorus.set(e,t);return n(t)}else{return n(r)}})};Phosphorus.listen=function(e,t){document.addEventListener("phosphorus-"+e,function(e){t.apply(null,[e.detail])})};Phosphorus.subscribe=function(e){Phosphorus.addToWatched(e);token_and_key=Phosphorus.token.toString()+":"+e.toString();if(!Phosphorus.socket.$events||!Phosphorus.socket.$events[token_and_key]){Phosphorus.socket.on(token_and_key,function(t){console.log("socket emission received!");var n=document.createEvent("Event");n.initEvent("phosphorus-"+e.toString(),true,false);n.detail=t;document.dispatchEvent(n);localStorage[token_and_key]=JSON.stringify(t)})}};Phosphorus.unsubscribe=function(e,t){token_and_key=Phosphorus.token.toString()+":"+e.toString();Phosphorus.socket.removeAllListeners(token_and_key);if(t)t()};Phosphorus.restart=function(){if(localStorage["watched"]){watched=Phosphorus.watched();for(var e=0;e<watched.length;e++){localStorage.removeItem(watched[e])}localStorage.removeItem("watched")}return""};Phosphorus.addToWatched=function(e){watched=Phosphorus.watched();token_and_key=Phosphorus.token.toString()+":"+e.toString();watched.push(token_and_key);localStorage["watched"]=JSON.stringify(watched)};Phosphorus.watched=function(){if(!localStorage["watched"]){return[]}return JSON.parse(localStorage["watched"])};Array.prototype.contains=function(e){var t=this.length;while(t--){if(this[t]===e){return true}}return false};var ajax=function(e,t,n){$.post(Phosphorus.baseUrl+e,t,function(e){if(n){n(e)}})};window.onbeforeunload=Phosphorus.restart();window.Phosphorus=Phosphorus;window.Fos4us=Phosphorus